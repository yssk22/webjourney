<VirtualHost *:80>
  # Section1. Base Setting
  ServerName <%= httpd["servername"] %>
  DocumentRoot <%= httpd["docroot"] %>
  ErrorLog logs/webjourney_error_log
  AllowEncodedSlashes On
  <Directory "<%= httpd['docroot'] %>">
    Options FollowSymlinks
    AllowOverride All
    Allow from all
  </Directory>
  ProxyRequests Off
  KeepAlive Off

  # Section2. Application Setting
  #  2.1 Rack Application
  RackBaseURI /social
  RackEnv     <%= WEBJOURNEY_ENV %>
  ProxyPass /social !

  #  2.2 Shindig Applicaiton
  ProxyPass /shindig !
  <Location /shindig>
    RewriteEngine on
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ /shindig/index.php [L]
  </Location>

  #  2.3 CouchDB Application
  <%
     #  TODO all the requests are proxied to CouchDB, but is this really OK?
     #  /_util/scripts/ are required.
     #  /{db} are required.
  %>
  <% DB_TO_APPNAMES.each do |db_uri, appnames| -%>
ProxyPass / <%= URI.parse(db_uri).to_s.split("/")[0...-1].join("/") %>/ nocanon
  ProxyPassReverse / <%= URI.parse(db_uri).to_s.split("/")[0...-1].join("/") %>/
  <% end -%>

</VirtualHost>
