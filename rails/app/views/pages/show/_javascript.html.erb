<script type="text/javascript">
  Page = new WebJourney.ShowPage(<%= @page.to_json %>, <%= page_url(@page._id).to_json %>);
  $(document).ready(function(){
  $('#component_menu').jdMenu();
  Page.adjustGrid();
  Page.setRootPath(<%= root_path.to_json %>);
  Page.setAuthToken(<%= form_authenticity_token.to_json %>);
  Page.setEditable(<%= @page.permit_relationship_of?(current_user, :edit).to_json %>);
  Page.setCurrentLoginName(<%= current_user.login_name.to_json %>);
  Page.prepareDialogs();
  Page.initWidgetInstances(<%= @widget_instances.to_json %>)
  });
</script>
<% @widget_instances.map { |pos, instances| instances }.flatten.each do |instance| -%>
<%= javascript_include_tag(instance.javascript_path) if instance.has_javascript? -%>
<% end -%>
