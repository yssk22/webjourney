<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <meta name="generator"   content="WebJourney Component Page Generator" />
    <title><%=h @page.title %> - WebJourney </title>
    <%= render_file File.join(RAILS_ROOT, "/app/views/share/stylesheets.html.erb"), false %>
    <%= render_file File.join(RAILS_ROOT, "/app/views/share/javascripts.html.erb"), false %>
    <style type="text/css">
      div#widgets          { <%= render_page_container_style(@page) %> }
      div#left_container   { <%= render_left_container_style(@page) %> }
      div#right_container  { <%= render_right_container_style(@page) %> }
      div#top_container    { <%= render_top_container_style(@page) %>}
      div#bottom_container { <%= render_bottom_container_style(@page) %>}
    </style>
    <script type="text/javascript">
      Page = new WebJourney.ShowPage(<%= @page.to_json %>, <%= page_url(@page._id).to_json %>);
      $(document).ready(function(){
      $('#component_menu').jdMenu();
      Page.adjustGrid();
      Page.setRootPath(<%= root_path.to_json %>);
      Page.setAuthToken(<%= form_authenticity_token.to_json %>);
      Page.setEditable(<%= @page.permit_relationship_of?(current_user, :edit).to_json %>);
      Page.setCurrentLoginName(<%= current_user.login_name.to_json %>);
      Page.prepareDialogs();
      Page.initWidgetInstances(<%= @widget_instances.to_json %>)
      });
    </script>
    <!-- widget specified stylesheets/javascripts loading -->
    <%= stylesheet_link_tag *(@page.get_current_widget_instances.map(&:stylesheet_path)) %>
    <%= javascript_include_tag *(@page.get_current_widget_instances.map(&:javascript_path)) %>
  </head>
  <body>
    <div id="header" class="header">
      <div id="logo"><%= link_to image_tag("default_logo.png"), page_url("top") %></a></div>
      <div id="login">
        <%= mypage_link(current_user) %>
        <%= user_link(current_user) %>
        <%= login_link %>
      </div>
      <div id="navigation">
        <div id="menu_navigation">
          <%= render_file File.join(RAILS_ROOT, "/app/views/share/component_menu.html.erb"), false %>
        </div>
        <div id="page_navigation">
          <%= create_link %>
          <%= edit_link %>
          <span id="page_deleting"  class="icon_page-deleting with_inline_icon" style="display:none"></span>
          <%= delete_link %>
        </div>
      </div>
    </div><!-- end of header -->
    <div id="body" class="body">
      <div id="widgets" class="widgets">
        <div id="top_container" class="widget_container">
        </div><!-- end of top_container -->
        <div id="wrapper">
          <div id="main">
            <div id="center_container" class="widget_container">
              <% @page.widgets["center"].each do |widget| %>
              <%= render :partial => "widget_instance", :locals => {:instance => @widget_instances[widget["instance_id"]] } %>
              <% end %>
            </div>
          </div><!-- end of center_container -->
          <div id="left_container" class="widget_container">
          </div><!-- end of left_container -->
        </div><!-- end of wrapper -->

        <div id="right_container" class="widget_container">
        </div><!-- end of right_container -->

        <div id="bottom_container">

        </div><!-- end of bottom_container -->
      </div>
    </div><!-- end of body -->
    <div id="footer" class="footer">
      <div class="powered-by">
        <span>Powered by <a href="http://project.webjourney.org/webjourney/trac">WebJourney</a> &copy; 2006-2008 webjourney.org </span>
      </div>
    </div><!-- end of footer -->
    <% form_tag pages_url(), :id => "new_page_form" do %>
    <% end %>
  </body>
</html>

